{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.readJWT = exports.generateJWT = undefined;\n\nvar _extends2 = require('babel-runtime/helpers/extends');\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar _jsonwebtoken = require('jsonwebtoken');\n\nvar _jsonwebtoken2 = _interopRequireDefault(_jsonwebtoken);\n\nvar _objectPath = require('object-path');\n\nvar _objectPath2 = _interopRequireDefault(_objectPath);\n\nvar _encrypt = require('./encrypt');\n\nvar _encrypt2 = _interopRequireDefault(_encrypt);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nconst generateJWT = (() => {\n  var _ref = (0, _asyncToGenerator3.default)(function* (jwtDetails, pubData = {}, encSettings = {}, encData = {}, encDataKey = 'encData') {\n    const jwtPayload = {\n      public: pubData\n    };\n    jwtPayload[encDataKey] = yield _encrypt2.default.serializeEncr(encSettings, encData);\n    const jwtDefaults = {\n      algorithm: 'HS256',\n      expiresIn: '12h'\n    };\n    const jwtParams = (0, _extends3.default)({}, jwtDetails);\n    const iss = jwtParams.key;\n    delete jwtParams.key;\n    const {\n      secret\n    } = jwtParams;\n    delete jwtParams.secret;\n    return _jsonwebtoken2.default.sign({\n      iss,\n      data: jwtPayload\n    }, secret, (0, _extends3.default)({}, jwtDefaults, jwtParams));\n  });\n\n  return function generateJWT(_x) {\n    return _ref.apply(this, arguments);\n  };\n})();\n\nconst readJWT = (tokenStr, encSettings, encDataKey = 'encData') => {\n  const tokenData = _jsonwebtoken2.default.decode(tokenStr);\n\n  if (tokenData === null) throw new Error('Invalid JWT!');\n\n  const publicData = _objectPath2.default.get(tokenData, 'data.public', {});\n\n  const encryptedData = _objectPath2.default.get(tokenData, `data.${encDataKey}`, '');\n\n  const newData = (0, _extends3.default)({}, publicData, _encrypt2.default.serializeDecr(encSettings, encryptedData));\n  tokenData.data = newData;\n  return tokenData;\n};\n\nexports.generateJWT = generateJWT;\nexports.readJWT = readJWT;","map":{"version":3,"sources":["/home/whitewalker/Projects/icep2/LBS-front/node_modules/jwt-token-encrypt/compiled/jwt-token-encrypt.js"],"names":["Object","defineProperty","exports","value","readJWT","generateJWT","undefined","_extends2","require","_extends3","_interopRequireDefault","_asyncToGenerator2","_asyncToGenerator3","_jsonwebtoken","_jsonwebtoken2","_objectPath","_objectPath2","_encrypt","_encrypt2","obj","__esModule","default","_ref","jwtDetails","pubData","encSettings","encData","encDataKey","jwtPayload","public","serializeEncr","jwtDefaults","algorithm","expiresIn","jwtParams","iss","key","secret","sign","data","_x","apply","arguments","tokenStr","tokenData","decode","Error","publicData","get","encryptedData","newData","serializeDecr"],"mappings":"AAAA;;AAEAA,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAC3CC,EAAAA,KAAK,EAAE;AADoC,CAA7C;AAGAD,OAAO,CAACE,OAAR,GAAkBF,OAAO,CAACG,WAAR,GAAsBC,SAAxC;;AAEA,IAAIC,SAAS,GAAGC,OAAO,CAAC,+BAAD,CAAvB;;AAEA,IAAIC,SAAS,GAAGC,sBAAsB,CAACH,SAAD,CAAtC;;AAEA,IAAII,kBAAkB,GAAGH,OAAO,CAAC,wCAAD,CAAhC;;AAEA,IAAII,kBAAkB,GAAGF,sBAAsB,CAACC,kBAAD,CAA/C;;AAEA,IAAIE,aAAa,GAAGL,OAAO,CAAC,cAAD,CAA3B;;AAEA,IAAIM,cAAc,GAAGJ,sBAAsB,CAACG,aAAD,CAA3C;;AAEA,IAAIE,WAAW,GAAGP,OAAO,CAAC,aAAD,CAAzB;;AAEA,IAAIQ,YAAY,GAAGN,sBAAsB,CAACK,WAAD,CAAzC;;AAEA,IAAIE,QAAQ,GAAGT,OAAO,CAAC,WAAD,CAAtB;;AAEA,IAAIU,SAAS,GAAGR,sBAAsB,CAACO,QAAD,CAAtC;;AAEA,SAASP,sBAAT,CAAgCS,GAAhC,EAAqC;AAAE,SAAOA,GAAG,IAAIA,GAAG,CAACC,UAAX,GAAwBD,GAAxB,GAA8B;AAAEE,IAAAA,OAAO,EAAEF;AAAX,GAArC;AAAwD;;AAE/F,MAAMd,WAAW,GAAG,CAAC,MAAM;AACzB,MAAIiB,IAAI,GAAG,CAAC,GAAGV,kBAAkB,CAACS,OAAvB,EAAgC,WAAWE,UAAX,EAAuBC,OAAO,GAAG,EAAjC,EAAqCC,WAAW,GAAG,EAAnD,EAAuDC,OAAO,GAAG,EAAjE,EAAqEC,UAAU,GAAG,SAAlF,EAA6F;AACtI,UAAMC,UAAU,GAAG;AACjBC,MAAAA,MAAM,EAAEL;AADS,KAAnB;AAIAI,IAAAA,UAAU,CAACD,UAAD,CAAV,GAAyB,MAAMT,SAAS,CAACG,OAAV,CAAkBS,aAAlB,CAAgCL,WAAhC,EAA6CC,OAA7C,CAA/B;AAEA,UAAMK,WAAW,GAAG;AAClBC,MAAAA,SAAS,EAAE,OADO;AAElBC,MAAAA,SAAS,EAAE;AAFO,KAApB;AAKA,UAAMC,SAAS,GAAG,CAAC,GAAGzB,SAAS,CAACY,OAAd,EAAuB,EAAvB,EAA2BE,UAA3B,CAAlB;AAEA,UAAMY,GAAG,GAAGD,SAAS,CAACE,GAAtB;AACA,WAAOF,SAAS,CAACE,GAAjB;AACA,UAAM;AAAEC,MAAAA;AAAF,QAAaH,SAAnB;AACA,WAAOA,SAAS,CAACG,MAAjB;AAEA,WAAOvB,cAAc,CAACO,OAAf,CAAuBiB,IAAvB,CAA4B;AACjCH,MAAAA,GADiC;AAEjCI,MAAAA,IAAI,EAAEX;AAF2B,KAA5B,EAGJS,MAHI,EAGI,CAAC,GAAG5B,SAAS,CAACY,OAAd,EAAuB,EAAvB,EAA2BU,WAA3B,EAAwCG,SAAxC,CAHJ,CAAP;AAID,GAvBU,CAAX;;AAyBA,SAAO,SAAS7B,WAAT,CAAqBmC,EAArB,EAAyB;AAC9B,WAAOlB,IAAI,CAACmB,KAAL,CAAW,IAAX,EAAiBC,SAAjB,CAAP;AACD,GAFD;AAGD,CA7BmB,GAApB;;AA+BA,MAAMtC,OAAO,GAAG,CAACuC,QAAD,EAAWlB,WAAX,EAAwBE,UAAU,GAAG,SAArC,KAAmD;AACjE,QAAMiB,SAAS,GAAG9B,cAAc,CAACO,OAAf,CAAuBwB,MAAvB,CAA8BF,QAA9B,CAAlB;;AAEA,MAAIC,SAAS,KAAK,IAAlB,EAAwB,MAAM,IAAIE,KAAJ,CAAU,cAAV,CAAN;;AAExB,QAAMC,UAAU,GAAG/B,YAAY,CAACK,OAAb,CAAqB2B,GAArB,CAAyBJ,SAAzB,EAAoC,aAApC,EAAmD,EAAnD,CAAnB;;AACA,QAAMK,aAAa,GAAGjC,YAAY,CAACK,OAAb,CAAqB2B,GAArB,CAAyBJ,SAAzB,EAAqC,QAAOjB,UAAW,EAAvD,EAA0D,EAA1D,CAAtB;;AAEA,QAAMuB,OAAO,GAAG,CAAC,GAAGzC,SAAS,CAACY,OAAd,EAAuB,EAAvB,EAA2B0B,UAA3B,EAAuC7B,SAAS,CAACG,OAAV,CAAkB8B,aAAlB,CAAgC1B,WAAhC,EAA6CwB,aAA7C,CAAvC,CAAhB;AACAL,EAAAA,SAAS,CAACL,IAAV,GAAiBW,OAAjB;AAEA,SAAON,SAAP;AACD,CAZD;;AAcA1C,OAAO,CAACG,WAAR,GAAsBA,WAAtB;AACAH,OAAO,CAACE,OAAR,GAAkBA,OAAlB","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.readJWT = exports.generateJWT = undefined;\n\nvar _extends2 = require('babel-runtime/helpers/extends');\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar _jsonwebtoken = require('jsonwebtoken');\n\nvar _jsonwebtoken2 = _interopRequireDefault(_jsonwebtoken);\n\nvar _objectPath = require('object-path');\n\nvar _objectPath2 = _interopRequireDefault(_objectPath);\n\nvar _encrypt = require('./encrypt');\n\nvar _encrypt2 = _interopRequireDefault(_encrypt);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nconst generateJWT = (() => {\n  var _ref = (0, _asyncToGenerator3.default)(function* (jwtDetails, pubData = {}, encSettings = {}, encData = {}, encDataKey = 'encData') {\n    const jwtPayload = {\n      public: pubData\n    };\n\n    jwtPayload[encDataKey] = yield _encrypt2.default.serializeEncr(encSettings, encData);\n\n    const jwtDefaults = {\n      algorithm: 'HS256',\n      expiresIn: '12h'\n    };\n\n    const jwtParams = (0, _extends3.default)({}, jwtDetails);\n\n    const iss = jwtParams.key;\n    delete jwtParams.key;\n    const { secret } = jwtParams;\n    delete jwtParams.secret;\n\n    return _jsonwebtoken2.default.sign({\n      iss,\n      data: jwtPayload\n    }, secret, (0, _extends3.default)({}, jwtDefaults, jwtParams));\n  });\n\n  return function generateJWT(_x) {\n    return _ref.apply(this, arguments);\n  };\n})();\n\nconst readJWT = (tokenStr, encSettings, encDataKey = 'encData') => {\n  const tokenData = _jsonwebtoken2.default.decode(tokenStr);\n\n  if (tokenData === null) throw new Error('Invalid JWT!');\n\n  const publicData = _objectPath2.default.get(tokenData, 'data.public', {});\n  const encryptedData = _objectPath2.default.get(tokenData, `data.${encDataKey}`, '');\n\n  const newData = (0, _extends3.default)({}, publicData, _encrypt2.default.serializeDecr(encSettings, encryptedData));\n  tokenData.data = newData;\n\n  return tokenData;\n};\n\nexports.generateJWT = generateJWT;\nexports.readJWT = readJWT;"]},"metadata":{},"sourceType":"script"}